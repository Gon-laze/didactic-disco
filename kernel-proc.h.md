---
description: 进程相关定义
---

# kernel/proc.h

`kernel/proc.h`中存放了绝大多数进程相关的宏与数据结构，是整个操作系统中至关重要的一部分。

## 上下文/语境（context）

自然，一个操作系统不能也不应该从头到尾不间歇地执行下去。如果中途发生了严重的错误，系统必须能及时停止并返回原先状态。而如果中途需要处理更重要的事务，系统还要保存当前任务的状态以便处理完后继续工作。这样的异常及中断都涉及到寄存器的变化。

**context**的作用便是进行寄存器的清除及恢复。它保存了基本的数据寄存器（**s0~s11**），同时保存了返回时需要的地址**ra**及栈顶指针**sp**。xv6一般将其与`kernel/swtch.S`搭配来实现切换。

```c
// 为系统上下文切换保存寄存器
struct context {
  uint64 ra;
  uint64 sp;

  // 保存被调用方数据
  uint64 s0;
  uint64 s1;
  uint64 s2;
  uint64 s3;
  uint64 s4;
  uint64 s5;
  uint64 s6;
  uint64 s7;
  uint64 s8;
  uint64 s9;
  uint64 s10;
  uint64 s11;
};
```

## 

